#!/usr/bin/env node

// Import the sys library
var sys     = require('sys'),
  grunt     = require('grunt'),
  findup    = require('findup-sync'),
  bootstrap = require('../src/bootstrap'),
  open      = require('open'),
  _         = grunt.util._;

require(findup('Gruntfile.js'))(grunt, true);
var translation = './translations';
var options = _.defaults(grunt.config.get('translate').dist.options, {
  config                  : './translation',
  requireJS               : true,
  translationFunctionName : 'gt',
  autoOpen                : false
});
options.output    = options.config + '/output';
options.deleteLog = options.config + '/delete.log';

// Import the optparse library.
var optparse = require('optparse');

// Switches
var switches = [
  ['-h', '--help', 'Shows help sections']
];

var arguments = process.argv.splice(2);
switch(arguments[0]) {
  case 'interface':
    var server = require('../app/server');
    server.server();
    if(options.interface.autoOpen) {
      open('http://localhost:' + options.interface.port);
    }
    break;
  case 'update':
  case 'compile':
  case 'log':
    bootstrap[arguments[0]](options);
    break;
  case 'search':
    if(typeof arguments[1] === 'undefined') {
      grunt.log.error('You need to provide a string in your search');
      return false;
    }
    bootstrap.search(options, arguments[1]);
    break;
  default:
    break;
}

